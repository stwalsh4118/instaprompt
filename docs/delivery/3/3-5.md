# 3-5 Integrate Template Engine with Select Command

[Back to task list](./tasks.md)

## Description

Integrate the template engine into the select prompt command flow so templates are processed before copying to clipboard.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-12-23 12:00:00 | Created | N/A | Proposed | Task file created | User |
| 2025-12-25 10:45:00 | Status Change | Proposed | InProgress | Started implementation | AI Agent |
| 2025-12-25 10:50:00 | Status Change | InProgress | Review | Implementation complete, template engine integrated with select command | AI Agent |
| 2025-12-25 11:00:00 | Status Change | Review | Done | Task completed and verified | AI Agent |

## Requirements

1. Modify selectPrompt command to process templates
2. Call resolveTemplate() after prompt selection, before clipboard copy
3. Handle resolution cancellation (user cancelled manual input)
4. Handle resolution errors gracefully
5. Only copy fully resolved content to clipboard

## Implementation Plan

1. Update selectPrompt command in extension.ts
2. After getting selected prompt content:
   - Call `resolveTemplate(content)`
   - Handle cancellation (return without copying)
   - Handle errors (show error message)
3. Copy resolved content to clipboard
4. Show notification with resolved content indicator

## Verification

- [ ] Templates with built-in variables resolve automatically
- [ ] Templates with custom variables prompt for input
- [ ] Cancellation during resolution doesn't copy anything
- [ ] Plain text prompts (no variables) work unchanged
- [ ] Resolved content is what gets copied

## Test Plan

- Select prompt with `{FILENAME}`, copies resolved filename
- Select prompt with `{CUSTOM}`, prompts then copies
- Cancel during input, nothing copied
- Prompt without variables copies as-is

## Files Modified

- `src/extension.ts` (modified)
  - Added imports for `resolveTemplate`, `promptForVariable`, `VariableResolutionCancelled`, and `registerBuiltinResolvers` from templateEngine
  - Called `registerBuiltinResolvers()` in `activate()` function to initialize built-in variable resolvers
  - Updated `handleSelectPrompt()` to resolve template variables before copying to clipboard
  - Added error handling for `VariableResolutionCancelled` (returns silently when user cancels)
  - Resolved content is now copied to clipboard instead of raw prompt content

